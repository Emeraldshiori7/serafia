/* ============== 基本トークン ============== */
:root{
  --ink:#e9dfd6;
  --bg:#000;
}

/* ============== リセット/土台 ============== */
*{ box-sizing: border-box }
html,body{ height:100%; margin:0 }
body.hall{
  font-family:"Cormorant Garamond","Yu Mincho",serif;
  color:var(--ink);
  background:#000;
  overflow:hidden;                    /* ステージ中央固定のため横スクロール回避 */
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* 背景の星（キャンバス） */
#dust{
  position:fixed; inset:0;
  display:block;
  z-index:0;
  contain: strict;                    /* レイヤ分離で再描画コストを下げる */
}

/* ============== タイトル（前面） ============== */
.hero{
  position:fixed; left:50%; top:0vh; transform:translateX(-50%);
  display:flex; flex-direction:column; align-items:center; gap:.6rem;
  z-index:5; pointer-events:none; text-align:center;
}
.hero h1{
  margin:0; font-family:"Cinzel",serif; font-weight:600;
  letter-spacing:.18em; font-size:clamp(28px,6vw,60px);
  color:#f3eadf;
  text-shadow:
    0 0 22px rgba(255,240,200,.45),
    0 0 36px rgba(255,220,150,.22);
}
.hero .subtitle{
  margin:0; font-style:italic; color:#d0c4b6;
  font-size:clamp(13px,2.4vw,18px);
  text-shadow: 0 0 16px rgba(255,220,150,.28);
}

/* ============== 祭壇ステージ（中央固定） ============== */
/* 置き換え：ステージを画面いっぱい＆中央基準 */
.hall-stage{
  position: fixed;
  inset: 0;                 /* ← left/top/width/height を一括で全画面 */
  transform: none;          /* 中央化トランスフォーム不要 */
  width: 100vw;
  height: 100vh;
  z-index: 1;
  isolation: isolate;
}
/* ============== 扉（枠なし・画像のみ） ============== */
.doors--orbit{ position:absolute; inset:0 }

.doors--orbit .door{
  position:absolute; top:0; left:0;
  width: clamp(180px, 22vmin, 260px);
  aspect-ratio: 3/4;
  --tx: 0px; --ty: 0px;
  transform: translate3d(var(--tx), var(--ty), 0) translate(-50%,-50%);
  will-change: transform;             /* ← transform のみに限定 */
  transition: transform .45s ease;    /* filter/opacity のトランジションは外す */
  display:flex; align-items:flex-end; justify-content:center;
  text-decoration:none; color:var(--ink);
  background-position:center;
  background-repeat:no-repeat;
  background-size:contain;
  /* 影は軽め一段のみ（drop-shadowは合成負荷が低め） */
  filter: drop-shadow(0 6px 14px rgba(0,0,0,.55));
  backface-visibility: hidden;
  -webkit-tap-highlight-color: transparent;
}

@media (hover:hover){
  .doors--orbit .door:hover{
    /* ほんの少しだけ明るさアップ（全体の暗さを保ったまま） */
    filter:
      drop-shadow(0 10px 24px rgba(0,0,0,.75))
      brightness(calc(0.82 + var(--depth)*0.24))
      contrast(calc(0.98 + var(--depth)*0.10))
      saturate(calc(0.92 + var(--depth)*0.22));
    transform:
      translate(var(--tx),var(--ty)) translate(-50%,-50%)
      scale(calc(var(--pulse) * (0.98 + var(--depth)*0.10)));
  }
  /* 内側ハイライトを少し強めに */
  .doors--orbit .door:hover::after{
    opacity: .60;
    filter: blur(16px);
    transform: scale(1.02);
  }
  /* 外縁の“ぼんやり光”をふわっと */
  .doors--orbit .door:hover::before{
    opacity: .32;
    filter: blur(22px);
    transform: scale(1.03);
  }
}


/* ラベル（銘板）今回は非表示 */
.door__label{ display:none !important }

/* 各扉の画像と雰囲気トーン */
.door--kagami{      --glow:#c8d6ff; background-image:url('assets/doors/kagami.png') }
.door--shosai{      --glow:#ffb36b; background-image:url('assets/doors/shosai.png') }
.door--reihaido{    --glow:#9ad1ff; background-image:url('assets/doors/reihaido.png') }
.door--atorie{      --glow:#ff99cf; background-image:url('assets/doors/atorie.png') }
.door--renkin{      --glow:#7bffb0; background-image:url('assets/doors/renkin.png') }
.door--teien{       --glow:#a7ff9a; background-image:url('assets/doors/teien.png') }
.door--shishitsu{   --glow:#d3b8ff; background-image:url('assets/doors/shishitsu.png') }
.door--kyakushitsu{ --glow:#ff9a9a; background-image:url('assets/doors/kyakushitsu.png') }
.door--gishiki{     --glow:#ffd37a; background-image:url('assets/doors/gishiki.png') }

/* 扉の淡い内光（合成コストの軽い screen を1枚だけ） */
.doors--orbit .door::after{
  content:""; position:absolute; inset:-8%;
  pointer-events:none;
  background: radial-gradient(40% 48% at 50% 60%, rgba(255,255,255,.0) 0,
    color-mix(in oklab, var(--glow) 26%, transparent) 40%,
    transparent 75%);
  mix-blend-mode: screen;
  opacity: .5;
}
/* ＝＝＝ 奥行きに応じて明暗・スケールを変える（やや暗め） ＝＝＝ */
.doors--orbit .door { --depth: .5; }

.doors--orbit .door{
  transform:
    translate(var(--tx),var(--ty)) translate(-50%,-50%)
    /* 手前で最大1.04倍くらい、控えめに浮かせる */
    scale(calc(var(--pulse) * (0.94 + var(--depth)*0.10)));
  /* デフォルトは全体を暗めに、手前ほど少しだけ明るく */
  filter:
    drop-shadow(0 6px 18px rgba(0,0,0, calc(0.60 + var(--depth)*0.28)))
    brightness(calc(0.72 + var(--depth)*0.20))
    contrast(calc(0.94 + var(--depth)*0.08))
    saturate(calc(0.85 + var(--depth)*0.20));
}

/* 既存の内光（::after）はベース暗め＆色は控えめ */
.doors--orbit .door::after{
  content:"";
  position:absolute; inset:-8%;
  background: radial-gradient(40% 48% at 50% 60%,
              color-mix(in oklab, var(--glow) 20%, transparent), transparent 70%);
  filter: blur(10px);
  opacity: .22;                /* ← ベースは薄く */
  mix-blend-mode: screen;
  pointer-events: none;
  transition: opacity .35s ease, filter .35s ease, transform .35s ease;
}

/* 外側のほんのり縁光（淡いリムライト） */
.doors--orbit .door::before{
  content:"";
  position:absolute; inset:-18%;
  background: radial-gradient(120% 120% at 50% 60%,
              color-mix(in oklab, var(--glow) 18%, transparent) 0%,
              transparent 60%);
  opacity: 0;                   /* ← 普段は見えない */
  filter: blur(18px);
  mix-blend-mode: screen;
  pointer-events: none;
  transition: opacity .35s ease, filter .35s ease, transform .35s ease;
}


/* ランダム暗転演出用（JSが付け外し） */
.door--dim{
  filter: drop-shadow(0 6px 14px rgba(0,0,0,.55)) brightness(.95);
  /* 疑似要素の光もすこし弱める（存在しない場合は無視され安全） */
}
.door--dim::after{ opacity:.25 }

/* ============== セラフィア（中央＋後光・軽量版） ============== */
.seraphia-silhouette{
  position:absolute; left:50%; top:48%;
  transform: translate(-50%, -50%);
  width: min(40vmin, 440px); aspect-ratio: 3/5;
  background: url('assets/seraphia/seraphia_manifest.png') center/contain no-repeat;
  mix-blend-mode: screen;
  opacity: .14;
  filter: grayscale(100%) contrast(120%) brightness(118%);
  pointer-events: none;
  z-index: 2;
  backface-visibility: hidden;
}

/* 後光：1枚の radial + ごく薄い conic（重すぎる多層は避ける） */
.seraphia-silhouette::before{
  content:""; position:absolute; inset:-14%;
  pointer-events:none; z-index:-1;
  mix-blend-mode: lighten;
  opacity:.78;
  filter: blur(16px) brightness(1.06);
  background:
    conic-gradient(from -90deg at 50% 42%, rgba(255,240,210,.10), transparent 18%,
                   rgba(255,240,210,.10) 36%, transparent 54%,
                   rgba(255,240,210,.10) 72%, transparent 90%,
                   rgba(255,240,210,.10) 100%),
    radial-gradient(62% 62% at 50% 56%, rgba(255,230,190,.28), transparent 80%);
  animation: halo 7s ease-in-out infinite;
}
@keyframes halo{
  0%,100%{ filter: blur(16px) brightness(1.04); opacity:.74 }
  50%    { filter: blur(20px) brightness(1.10); opacity:.92 }
}

/* ============== 囁き（前面・中央下） ============== */
/* 囁き（前面・中央下） */
.whisper{
  position: fixed;
  left: 50%;
  bottom: clamp(6vh, 10vh, 14vh);     /* ちょっと高めに */
  transform: translateX(-50%);
  width: min(96vw, 960px);            /* 横幅を広く */
  padding: 0 12px;                    /* 端で折り返しやすく */
  text-align: center;
  z-index: 1200;
  pointer-events: none;
  user-select: none;

  /* 下端でフェードする“見切れ防止”マスク（長文の安心枠） */
  -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 88%, rgba(0,0,0,0) 100%);
          mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 88%, rgba(0,0,0,0) 100%);
}

/* 2レイヤー（クロスフェード） */
.whisper .line{
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  display: inline-block;

  /* ⬇ フォントサイズはJSが --whisper-fs をセットして自動調整 */
  font-size: var(--whisper-fs, clamp(14px, 2.2vw, 19px));
  line-height: 1.8;

  /* 日本語の改行と長文耐性 */
  white-space: pre-line;     /* \n を改行として扱う */
  word-break: keep-all;      /* 日本語の自然な折り返し */
  overflow: hidden;          /* 枠外は隠す */
  max-width: 96%;            /* 端での不意なはみ出しを防ぐ */
  max-height: 34vh;          /* 高さの上限（JSがここに収める） */

  color:#cbbfb6;
  font-style: italic;
  letter-spacing:.06em;
  text-shadow:
    0 0 8px rgba(255,240,210,.25),
    0 0 22px rgba(255,230,180,.15);
  opacity:0; filter: blur(.4px);
}

.whisper .show{ animation: in 1200ms ease forwards, breathe 8s ease-in-out infinite }
.whisper .hide{ animation: out 1000ms ease forwards }

@keyframes in{ 0%{opacity:0; transform:translate(-50%,6px)} 100%{opacity:.9; transform:translate(-50%,0)} }
@keyframes out{ 0%{opacity:.9; transform:translate(-50%,0)} 100%{opacity:0; transform:translate(-50%,-4px)} }
@keyframes breathe{ 0%,100%{opacity:.9} 50%{opacity:.55} }

/* モバイルは少しタイトに */
@media (max-width: 768px){
  .whisper{
    bottom: max(10px, env(safe-area-inset-bottom));
    width: min(98vw, 720px);
    -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 92%, rgba(0,0,0,0) 100%);
            mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 92%, rgba(0,0,0,0) 100%);
  }
  .whisper .line{
    line-height: 1.75;
    max-height: 40vh;
  }
}

/* ============== 儀式ボタン（右下・薄く・波紋） ============== */
.ritual-btn{
  position:fixed; right:24px; bottom:22px;
  padding:.55rem .9rem; font-size:14px; letter-spacing:.08em;
  color:#e9e1d9; background:rgba(255,255,255,.06);
  border:none; border-radius:999px; cursor:pointer; z-index:7;
  backdrop-filter: blur(6px);
  box-shadow: 0 0 0 1px rgba(255,255,255,.10) inset, 0 8px 22px rgba(0,0,0,.38);
  transition: transform .2s ease, background .3s ease;
  -webkit-tap-highlight-color: transparent;
}
.ritual-btn:hover{ background:rgba(255,255,255,.10); transform:translateY(-1px) }
.ritual-btn i{ position:absolute; inset:0; border-radius:inherit; pointer-events:none; overflow:hidden }
.ritual-btn::after{
  content:""; position:absolute; left:50%; top:50%; width:10px; height:10px;
  border-radius:50%;
  background:radial-gradient(circle, rgba(255,240,210,.35), transparent 60%);
  transform:translate(-50%,-50%) scale(0); opacity:0;
  transition: transform .6s ease, opacity .6s ease;
}
.ritual-btn:hover::after{ transform:translate(-50%,-50%) scale(10); opacity:1 }

/* ============== アクセシビリティ/モーション配慮 ============== */
@media (prefers-reduced-motion: reduce){
  .doors--orbit .door,
  .seraphia-silhouette::before,
  .whisper .show,
  .whisper .hide,
  .ritual-btn::after{
    animation: none !important;
    transition: none !important;
  }
}

/* ============== モバイル微調整 ============== */
@media (max-width:768px){
  .hero{ top:8vh }
  .seraphia-silhouette{ width:min(46vmin,360px); opacity:.12 }
  .ritual-btn{ right:14px; bottom:14px }
}
/* ステージは積層を分離しておく */
.hall-stage{ isolation:isolate; }

/* セラフィア本体は“中央レイヤー”に固定 */
.seraphia-silhouette{
  z-index: 500;         /* ← ここが基準 */
}

/* セラフィアの後光は必ず背面（この値の範囲内） */
.seraphia-silhouette::before{ z-index: -1; }
.seraphia-silhouette::after { z-index: -2; }

/* 扉の初期 z-index はゼロ（JSで上書き） */
.doors--orbit .door{ z-index: 0; }
/* === 扉クリック時の“入室演出”＆落ち影＆暗めベース === */

/* 全体、ベースを少し暗めに（既存の雰囲気を崩さない範囲） */
.doors--orbit .door{
  filter: drop-shadow(0 4px 14px rgba(0,0,0,.7)) brightness(.92) contrast(1.02);
}

/* 扉の足元に楕円の落ち影（深度で濃さが変わる） */
.doors--orbit .door::before{
  content:"";
  position:absolute;
  left:50%; bottom:-3%;
  width:60%; height:20%;
  transform:translateX(-50%);
  background:radial-gradient(60% 60% at 50% 50%,
    rgba(0,0,0,var(--shadow, .22)), transparent 65%);
  filter: blur(8px);
  pointer-events:none;
  z-index:-1;
}

/* ホバー時は周囲がほんのり発光（カードっぽくはならない） */
@media (hover:hover){
  .doors--orbit .door:hover{
    filter: drop-shadow(0 10px 28px rgba(0,0,0,.8)) brightness(1.03);
  }
  .doors--orbit .door:hover::after{
    opacity:.8; filter: blur(16px);
  }
}

/* 入室演出：他の扉を薄く、選んだ扉を拡大して最前面に */
.doors--orbit.enter-mode .door{
  transition: transform .7s ease, opacity .55s ease, filter .55s ease;
}
.doors--orbit.enter-mode .door:not(.door--active){
  opacity:0;
  filter: blur(2px) brightness(.7) !important;
}
.doors--orbit .door.door--active{
  transform: translate(var(--tx),var(--ty)) translate(-50%,-50%) scale(1.3) !important;
  filter: drop-shadow(0 14px 40px rgba(0,0,0,.85)) brightness(1.08) !important;
  z-index: 900 !important;
}

/* 暗転レイヤー（フェードアウトして次画面へ） */
.fadeout{
  position:fixed; inset:0;
  background:#000;
  opacity:0; pointer-events:none;
  z-index: 999;
  transition: opacity .6s ease;
}
.fadeout.show{ opacity:1; }
#orbit-doors .door:focus-visible{
  outline:none;
  filter:drop-shadow(0 0 24px rgba(255,240,210,.25)) brightness(1.05);
}
@media (prefers-reduced-motion: reduce){
  .doors--orbit .door{ transition:none !important; }
  .seraphia-silhouette::before{ animation:none !important; }
}
.doors--orbit .door{
  filter:
    drop-shadow(0 4px 14px rgba(0,0,0,.6))
    brightness(calc(.55 + var(--depth, .5)*.55))
    contrast(1.02)
    saturate(calc(.9 + var(--depth, .5)*.2))
    blur(calc((1 - var(--depth, .5)) * 0.6px));
}
.door--active::before{
  content:""; position:absolute; inset:-6%;
  background:
    radial-gradient(60% 60% at 50% 50%, rgba(255,240,210,.22), transparent 70%),
    conic-gradient(from 90deg, rgba(255,240,210,.25), transparent 30% 70%, rgba(255,240,210,.25));
  filter: blur(10px);
  mix-blend-mode: screen;
  opacity: .9;
  animation: doorFlash .24s ease;
}
@keyframes doorFlash{ from{opacity:0} to{opacity:.9} }
